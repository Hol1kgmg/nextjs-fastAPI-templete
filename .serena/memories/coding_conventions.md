# コーディング規約と慣習

## 全体共通原則

### 日本語コミュニケーション
- 全てのコミット、コメント、エラーメッセージ、ユーザーとのやり取りは日本語
- テストタイトル、ドキュメンテーションも日本語で記述

### コメント原則
- **原則としてコードにコメントを記述しない**
- コードは自己説明的であるべき
- 例外的な許可ケース：
  - 複雑なロジックの「なぜ」の説明
  - リンター/コンパイラ指示（`// @ts-ignore`等）
  - 回避策（ワークアラウンド）の明示

## フロントエンド（TypeScript/React）

### 命名規則
- **ディレクトリ**: kebab-case
- **TSXファイル**: PascalCase
- **TSファイル**: camelCase
- **コンポーネント**: PascalCase（ファイル名と一致）
- **関数・変数**: camelCase
- **定数**: UPPER_SNAKE_CASE

### 関数定義スタイル
- **重要**: 全ての関数（Reactコンポーネント除く）はアロー関数で定義
- `function`キーワード禁止、常に`const`を使用したアロー関数形式

### 型定義スタイル
- **重要**: オブジェクトの型定義は`interface`ではなく`type`を使用
- `type`エイリアスで統一、柔軟性を活用

### コンポーネント設計原則
- **Server Components優先**: デフォルトはServer Component
- **Client Componentsは必要時のみ**: Reactフック、ブラウザAPI、イベントハンドラが必要な場合
- **Package by Feature**: 技術別ではなく機能別にコードを組織化

### ディレクトリ構造
```
src/components/
├── ui/                # shadcn/ui コンポーネントのみ
├── shared/           # 機能横断で再利用可能
└── features/         # 機能固有コンポーネント
```

### インポートルール
- **バレルファイル禁止**: `index.ts`での集約エクスポート禁止
- **直接インポート**: 個別ファイルから直接インポート
- **エイリアス使用**: `@/`エイリアスを使用、相対パス禁止

## バックエンド（Python/FastAPI）

### 命名規則（PEP 8準拠）
- **関数・変数**: snake_case
- **クラス**: PascalCase
- **定数**: UPPER_SNAKE_CASE
- **プライベート**: アンダースコア接頭辞（`_private_method`）

### 型アノテーション要件
- **必須**: 全ての関数、引数、戻り値に型アノテーション
- **Pydantic活用**: データ入出力には必ずPydanticモデル使用
- **辞書型よりPydantic**: 型安全性を優先
- **mypy strict**: 厳格な型チェック設定に準拠

### データベース設計原則
- **SQLAlchemy ORM**: データベースアクセス統一
- **Alembic**: マイグレーション管理
- **自動マイグレーション**: 意味のあるファイル名自動生成
- **トランザクション**: 適切な境界設定

### Package by Feature適用
```
src/
├── api/              # APIルート（機能別）
├── services/         # ビジネスロジック（機能別）
├── models/           # Pydanticモデル（機能別）
└── utils/            # 真にグローバルなユーティリティのみ
```

## 品質保証基準

### フロントエンド品質ツール
- **Biome**: リンティング・フォーマット統一
- **TypeScript**: 厳密な型チェック
- **similarity-ts**: コード重複検出（80%以上で警告）
- **Vitest**: テスト実行
- **Storybook**: コンポーネント開発・ドキュメント

### バックエンド品質ツール
- **Ruff**: PEP 8準拠のリンティング・フォーマット
- **mypy**: 厳格な型チェック（strict mode）
- **pytest**: テスト実行
- **coverage**: テストカバレッジ測定

### Git Hooks（lefthook）
- **pre-commit**: 自動修正・品質チェック・重複検出
- **pre-push**: ビルドテスト・CI/CD整合性確認
- **絶対禁止**: `LEFTHOOK=0`の使用

## テスト戦略

### フロントエンド
- **コンポーネントテスト**: propsによる分岐を網羅
- **ロジックテスト**: 純粋関数の単体テスト
- **Storybook**: 視覚的確認（propsで制御される分岐のみ）
- **目標カバレッジ**: 80%以上

### バックエンド
- **APIテスト**: HTTPステータス・レスポンス形式検証
- **サービステスト**: ビジネスロジック単体テスト
- **モデルテスト**: Pydanticバリデーションテスト
- **DBテスト**: CRUD操作・トランザクション検証
- **目標カバレッジ**: 85%以上

## アーキテクチャパターン

### データフロー（フロントエンド）
- **Entity**: アプリケーション核のデータ構造（zodスキーマ）
- **Gateway**: 外部システムとの境界層
- **型安全性**: EntitySchemaによる実行時バリデーション

### レイヤー構成（バックエンド）
- **API Layer**: FastAPIルート・エンドポイント
- **Service Layer**: ビジネスロジック
- **Model Layer**: Pydanticモデル・スキーマ
- **Database Layer**: SQLAlchemy・マイグレーション

## 開発効率化

### mise環境管理
- **統一バージョン**: 全ツールのバージョン統一管理
- **自動セットアップ**: `mise install`で環境完了

### Task統一コマンド
- **直感的命名**: `task dev`, `task check:all`, `task fix:all`
- **統合実行**: フロント・バック両方を統一操作
- **個別実行**: 必要に応じて個別環境でも実行可能

### Docker分離環境
- **独立コンテナ**: フロント・バック・DB各独立
- **開発パターン**: 軽量（DB+開発サーバー）、完全Docker等選択可能