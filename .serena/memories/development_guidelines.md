# 開発ガイドライン

## AI分離開発の重要原則

### AI役割分担の厳格な遵守
- **フロントエンドAI**: `frontend/`ディレクトリのみ操作
- **バックエンドAI**: `backend/`ディレクトリのみ操作
- **境界の絶対禁止**: 相互のディレクトリへの操作は一切禁止
- **専用ドキュメント必読**: 各AI専用のCLAUDE.mdが最優先ルール

### 事前承認の必須要件
**すべてのファイル操作前に必須**:
1. 対象ファイル一覧の明示
2. 実行する変更内容の詳細説明
3. 影響範囲の説明
4. ユーザーからの明示的承認取得

## 品質保証の絶対原則

### lefthookの絶対遵守
- **`LEFTHOOK=0`の使用禁止**: 品質チェック回避は一切許可しない
- **自動修正の受け入れ**: lefthookによる修正は品質向上のため
- **エラー対処**: 品質チェックエラーは必ず解決してからコミット

### コード品質ツールの遵守
#### フロントエンド
- **Biome**: リンティング・フォーマット厳守
- **TypeScript**: 厳格な型チェック（`any`型禁止）
- **similarity-ts**: 重複コード80%未満維持

#### バックエンド  
- **Ruff**: PEP 8準拠の厳格適用
- **mypy**: strict mode厳守（全関数に型アノテーション必須）
- **Pydantic**: データ入出力の型安全性確保

## コード記述の基本ルール

### コメント禁止原則
- **原則**: コードはコメントなしで自己説明的であるべき
- **例外のみ許可**:
  - 複雑なロジックの「なぜ」の説明
  - リンター指示（`// @ts-ignore`等）
  - 技術的制約による回避策の明示

### 命名規則の厳格遵守

#### フロントエンド
- **ディレクトリ**: kebab-case
- **TSXファイル**: PascalCase
- **TSファイル**: camelCase  
- **コンポーネント**: PascalCase（ファイル名と一致）
- **関数定義**: アロー関数必須（`function`禁止）
- **型定義**: `interface`禁止、`type`使用

#### バックエンド
- **全般**: PEP 8準拠
- **関数・変数**: snake_case
- **クラス**: PascalCase
- **定数**: UPPER_SNAKE_CASE

## 設計パターンの遵守

### Package by Feature原則
- **技術別ではなく機能別**: 関連コードを機能でグループ化
- **コロケーション**: 使用する場所の近くに関連コードを配置
- **グローバルは最小限**: 真に汎用的なもののみ共通ディレクトリ

### コンポーネント分離の判断基準
#### フロントエンド
- **Server Components優先**: デフォルトはServer Component
- **分離基準**: テスト可能性で判断（行数ではない）
- **Presenter分離**: 複雑な表示ロジックは別ファイル化
- **バレルファイル禁止**: `index.ts`での集約禁止

#### バックエンド
- **レイヤー分離**: API・Service・Model・Database層の明確な分離
- **Pydantic活用**: 辞書型よりPydanticモデル優先
- **型アノテーション**: 全関数に必須

## テスト戦略の遵守

### テストタイトル日本語化
- **必須**: 全テストタイトルは日本語
- **具体性**: 条件と期待結果を明確に表現
- **形式**: 「〜の場合、〜すること」パターン

### テスト分離戦略
#### フロントエンド
- **コンポーネントテスト**: props制御の分岐網羅
- **ロジックテスト**: 純粋関数の単体テスト
- **Storybook**: 視覚的確認（非視覚的ストーリー禁止）
- **スナップショット**: HTML構造・ARIA属性変更検出

#### バックエンド
- **APIテスト**: エンドポイント動作検証
- **サービステスト**: ビジネスロジック単体テスト
- **モデルテスト**: Pydanticバリデーション検証
- **DBテスト**: CRUD・トランザクション検証

## 開発ワークフローの標準化

### 標準開発手順
1. **タスク理解**: 要件の明確化、不明点の質問
2. **計画立案**: 詳細実行計画、影響範囲特定
3. **事前報告**: ユーザーへの計画報告、明示的承認取得
4. **実行**: 計画に従った実装、予期しない状況の即座報告
5. **完了報告**: 実行結果の詳細報告、変更確認要求

### 品質チェック手順
```bash
# 必須実行順序
task fix:all      # 1. 自動修正統合実行
task check:all    # 2. 品質チェック統合実行
task test         # 3. 全テスト実行
task build        # 4. ビルド確認
```

## API連携・統合の原則

### スキーマ駆動開発
- **OpenAPI/JSON Schema**: API仕様の事前定義
- **型共有**: PydanticモデルからTypeScript型生成
- **独立開発**: 各AI専用ドキュメントに従い独立開発
- **統合テスト**: 定期的な連携確認

### スキーマ変更手順
1. **バックエンドAI**: Pydanticモデル変更・検証
2. **API仕様生成**: FastAPI自動生成スキーマ確認
3. **フロントエンドAI**: TypeScript型定義同期
4. **統合テスト**: API通信テスト実行

## セキュリティ・プライバシー配慮

### セキュリティベストプラクティス
- **秘密情報の非露出**: 環境変数適切使用
- **入力データ検証**: Pydantic・zodによるバリデーション
- **認証・認可**: FastAPI依存性注入活用
- **SQLインジェクション対策**: SQLAlchemy ORM使用

### ログ・デバッグ情報
- **秘密情報ログ禁止**: APIキー、パスワード等の出力禁止
- **適切な日本語メッセージ**: ユーザー向けエラーメッセージ

## パフォーマンス考慮事項

### フロントエンド最適化
- **Server Components優先**: 初期表示速度向上
- **適切なキャッシング**: Next.js機能活用
- **バンドルサイズ監視**: 不要な依存関係排除

### バックエンド最適化
- **非同期処理**: async/await適切使用
- **データベース最適化**: インデックス、クエリ最適化
- **接続プール**: 適切な接続管理

## 継続的改善・メンテナンス

### 定期的な品質向上
- **依存関係更新**: セキュリティパッチ適用
- **コードリファクタリング**: 技術的負債解消
- **メトリクス監視**: カバレッジ・品質指標確認
- **ドキュメント更新**: 開発手順・ガイドライン改善

### 知識共有・継承
- **ベストプラクティス文書化**: 新たな発見の記録
- **問題解決パターン**: トラブルシューティング情報蓄積
- **設計決定理由**: アーキテクチャ選択の背景記録